{% extends "base.html" %}

{% block title %}{{ t.get('nav_messages', 'Messages') }}{% endblock %}

{% block content %}
<h1>{{ t.get('messages_title', 'Messages') }}</h1>

{% if confirmation %}
    <div class="confirmation" id="confirmation">
        âœ… {{ t.get('messages_confirmation', 'Message sent successfully') }}
    </div>
{% endif %}

{% if messages %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>{{ t.get('messages_col_email', 'Email') }}</th>
                <th>{{ t.get('messages_col_message', 'Message') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for msg in messages %}
            <tr onclick="openModal(
                '{{ msg.id }}',
                '{{ msg.sender_email | e }}',
                '{{ msg.message | e }}'
            )">
                <td>{{ msg.id }}</td>
                <td>{{ msg.sender_email }}</td>
                <td>
                    {{ msg.message[:50] ~ ('...' if msg.message|length > 50 else '') }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p style="text-align:center; color:#555;">
        {{ t.get('messages_no_data', 'No messages yet') }}
    </p>
{% endif %}

<!-- Modal -->
<div id="messageModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>{{ t.get('messages_modal_title', 'Message details') }}</h2>

        <p>
            <strong>ID :</strong>
            <span id="modalId"></span>
        </p>

        <p>
            <strong>{{ t.get('messages_col_email', 'Email') }} :</strong>
            <span id="modalEmail"></span>
        </p>

        <p>
            <strong>{{ t.get('messages_col_message', 'Message') }} :</strong>
        </p>
        <p id="modalMessage"></p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function openModal(id, email, message) {
    document.getElementById("modalId").innerText = id;
    document.getElementById("modalEmail").innerText = email;
    document.getElementById("modalMessage").innerText = message;
    document.getElementById("messageModal").style.display = "block";
}

function closeModal() {
    document.getElementById("messageModal").style.display = "none";
}

window.onclick = function(event) {
    const modal = document.getElementById("messageModal");
    if (event.target === modal) {
        closeModal();
    }
}

// Disparition auto confirmation
setTimeout(function() {
    const conf = document.getElementById("confirmation");
    if (conf) {
        conf.style.transition = "opacity 1s ease";
        conf.style.opacity = "0";
        setTimeout(() => conf.remove(), 1000);
    }
}, 5000);
</script>
{% endblock %}
